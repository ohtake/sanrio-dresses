<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../">
  <title data-ice="title">src/Statistics.jsx | sanrio-wardrobe</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  <script src="script/manual.js"></script>
</head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  <a href="test.html" data-ice="testLink">Test</a>
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/Character.jsx~Character.html">Character</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/colors.js~ColorData.html">ColorData</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/data_file.js~DataFile.html">DataFile</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/photo.js~Photo.html">Photo</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/srcset_providers.js~FlickrSrcsetProvider.html">FlickrSrcsetProvider</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/srcset_providers.js~Instagram2SrcsetProvider.html">Instagram2SrcsetProvider</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/srcset_providers.js~InstagramSrcsetProvider.html">InstagramSrcsetProvider</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/srcset_providers.js~PicasaSrcsetProvider.html">PicasaSrcsetProvider</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-JustifiedLayout">JustifiedLayout</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-applyThemeToBody">applyThemeToBody</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-getRouterHistory">getRouterHistory</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-openFeedback">openFeedback</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-sendGoogleAnalyticsEvent">sendGoogleAnalyticsEvent</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-withFullWidth">withFullWidth</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-RepresentiveColors">RepresentiveColors</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-themeDarkV1">themeDarkV1</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-themeLightV1">themeLightV1</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">src/Statistics.jsx</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">import React from &apos;react&apos;;
import PropTypes from &apos;prop-types&apos;;
import toPairs from &apos;lodash/toPairs&apos;;
import RouterLink from &apos;react-router-dom/Link&apos;;

import { withStyles } from &apos;@material-ui/core/styles&apos;;
import Avatar from &apos;@material-ui/core/Avatar&apos;;
import Button from &apos;@material-ui/core/Button&apos;;
import CircularProgress from &apos;@material-ui/core/CircularProgress&apos;;
import Table from &apos;@material-ui/core/Table&apos;;
import TableBody from &apos;@material-ui/core/TableBody&apos;;
import TableCell from &apos;@material-ui/core/TableCell&apos;;
import TableHead from &apos;@material-ui/core/TableHead&apos;;
import TableRow from &apos;@material-ui/core/TableRow&apos;;
import Paper from &apos;@material-ui/core/Paper&apos;;
import Tabs from &apos;@material-ui/core/Tabs&apos;;
import Tab from &apos;@material-ui/core/Tab&apos;;

import clone from &apos;lodash/clone&apos;;

import Colors from &apos;./colors&apos;;
import DataFile from &apos;./data_file&apos;;

function sum(arr) {
  return arr.reduce((acc, current) =&gt; acc + current);
}

function renderCell(content, propsForCell = {}) {
  const { style } = propsForCell;
  const cellStyle = clone(style) || {};
  cellStyle.padding = 4;
  return &lt;TableCell numeric={propsForCell.numeric} style={cellStyle}&gt;{content}&lt;/TableCell&gt;;
}

class Statistics extends React.Component {
  constructor() {
    super();
    this.state = { statistics: null, error: null, tabIndex: 0 };
    this.handleTabChange = this.handleTabChange.bind(this);
  }

  componentDidMount() {
    const { setTitle } = this.context;
    setTitle();
    window.fetch(&apos;assets/statistics.json&apos;).then((res) =&gt; {
      if (res.ok) {
        return res.json();
      }
      throw new Error(res.statusText);
    }).then((stat) =&gt; {
      this.setState({ statistics: stat });
    }).catch((err) =&gt; {
      this.setState({ error: err });
    });
  }

  handleTabChange(event, value) {
    this.setState({ tabIndex: value });
  }

  renderAvatarCell(df) {
    const { classes } = this.props;
    return renderCell(
      &lt;Button size=&quot;small&quot; component={RouterLink} to={`/chara/${df.name}`}&gt;
        {df.picUrl ? &lt;Avatar src={df.picUrl} className={classes.avatar} /&gt; : (
          &lt;Avatar className={classes.avatar}&gt;{df.seriesSymbol}&lt;/Avatar&gt;
        )}
        {df.name}
      &lt;/Button&gt;,
    );
  }

  renderCount() {
    const { classes } = this.props;
    const { statistics } = this.state;
    const sortedNameCountPairs = toPairs(statistics.count).sort((x, y) =&gt; {
      const countDiff = y[1] - x[1];
      if (countDiff !== 0) return countDiff;
      return x[0].localeCompare(y[0]);
    });
    const totalCount = sum(sortedNameCountPairs.map((p) =&gt; p[1]));
    return (
      &lt;React.Fragment&gt;
        &lt;p&gt;{`${DataFile.all.length} characters, ${totalCount} photos`}&lt;/p&gt;
        &lt;Paper className={classes.tableWraper}&gt;
          &lt;Table&gt;
            &lt;TableHead&gt;
              &lt;TableRow&gt;
                {renderCell(&apos;Character&apos;)}
                {renderCell(&apos;Count&apos;)}
                {renderCell(&apos;Series&apos;)}
                {renderCell(&apos;Name (ja)&apos;)}
                {renderCell(&apos;Name (en)&apos;)}
              &lt;/TableRow&gt;
            &lt;/TableHead&gt;
            &lt;TableBody&gt;
              {sortedNameCountPairs.map((p) =&gt; {
                const df = DataFile.findByName(p[0]);
                return (
                  &lt;TableRow hover&gt;
                    {this.renderAvatarCell(df)}
                    {renderCell(statistics.count[df.name], { numeric: true })}
                    {renderCell(df.seriesSymbol)}
                    {renderCell(df.nameJa)}
                    {renderCell(df.nameEn)}
                  &lt;/TableRow&gt;
                );
              })}
            &lt;/TableBody&gt;
          &lt;/Table&gt;
        &lt;/Paper&gt;
      &lt;/React.Fragment&gt;
    );
  }

  renderColor() {
    const { classes } = this.props;
    const { statistics } = this.state;
    const totalCount = sum(DataFile.all.map((df) =&gt; sum(Colors.all.map((c) =&gt; statistics.color[df.name][c.id]))));
    return (
      &lt;React.Fragment&gt;
        &lt;p&gt;{`${totalCount} colors`}&lt;/p&gt;
        &lt;Paper className={classes.tableWraper}&gt;
          &lt;Table&gt;
            &lt;TableHead&gt;
              &lt;TableRow&gt;
                {renderCell(&apos;Character&apos;)}
                {Colors.all.map((c) =&gt; renderCell(c.name, { style: { color: &apos;black&apos;, backgroundColor: c.light } }))}
              &lt;/TableRow&gt;
            &lt;/TableHead&gt;
            &lt;TableBody&gt;
              {DataFile.all.map((df) =&gt; (
                &lt;TableRow hover&gt;
                  {this.renderAvatarCell(df)}
                  {Colors.all.map((c) =&gt; renderCell(statistics.color[df.name][c.id], { numeric: true, style: { color: &apos;black&apos;, backgroundColor: c.light } }))}
                &lt;/TableRow&gt;
              ))}
            &lt;/TableBody&gt;
          &lt;/Table&gt;
        &lt;/Paper&gt;
      &lt;/React.Fragment&gt;
    );
  }

  renderAuthor() {
    const { classes } = this.props;
    const { statistics } = this.state;
    const sortedAuthor = toPairs(statistics.author).sort((x, y) =&gt; {
      const countDiff = y[1] - x[1];
      if (countDiff !== 0) return countDiff;
      return x[0].localeCompare(y[0]);
    });
    return (
      &lt;React.Fragment&gt;
        &lt;p&gt;{`${sortedAuthor.length} authors`}&lt;/p&gt;
        &lt;Paper className={classes.tableWraper}&gt;
          &lt;Table&gt;
            &lt;TableHead&gt;
              &lt;TableRow&gt;
                {renderCell(&apos;Name&apos;)}
                {renderCell(&apos;Count&apos;)}
              &lt;/TableRow&gt;
            &lt;/TableHead&gt;
            &lt;TableBody&gt;
              {sortedAuthor.map((a) =&gt; (
                &lt;TableRow hover&gt;
                  {renderCell(a[0])}
                  {renderCell(a[1], { numeric: true })}
                &lt;/TableRow&gt;
              ))}
            &lt;/TableBody&gt;
          &lt;/Table&gt;
        &lt;/Paper&gt;
      &lt;/React.Fragment&gt;
    );
  }

  render() {
    const { statistics, error, tabIndex } = this.state;
    if (error) throw error;
    return (
      &lt;React.Fragment&gt;
        &lt;Tabs value={tabIndex} indicatorColor=&quot;primary&quot; onChange={this.handleTabChange}&gt;
          &lt;Tab label=&quot;Count&quot; /&gt;
          &lt;Tab label=&quot;Colors&quot; /&gt;
          &lt;Tab label=&quot;Authors&quot; /&gt;
        &lt;/Tabs&gt;
        {statistics ? (
          (tabIndex === 0 &amp;&amp; this.renderCount())
          || (tabIndex === 1 &amp;&amp; this.renderColor())
          || (tabIndex === 2 &amp;&amp; this.renderAuthor())
        ) : (
          &lt;p&gt;
            &lt;CircularProgress /&gt;
            Loading statistics...
          &lt;/p&gt;
        )}
      &lt;/React.Fragment&gt;
    );
  }
}
Statistics.propTypes = {
  // eslint-disable-next-line react/forbid-prop-types
  classes: PropTypes.object.isRequired,
};
Statistics.contextTypes = {
  setTitle: PropTypes.func,
};

export default withStyles({
  avatar: {
    width: 24,
    height: 24,
  },
  charaButton: {
    textTransform: &apos;none&apos;,
  },
  tableWraper: {
    overflowX: &apos;auto&apos;,
  },
})(Statistics);
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(1.1.0)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
